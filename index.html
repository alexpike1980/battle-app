<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <title>Батл: Кто круче?</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      text-align: center;
      padding: 20px;
    }

    h1 {
      margin-bottom: 30px;
    }

    .battle-container {
      display: flex;
      justify-content: center;
      gap: 40px;
      flex-wrap: wrap;
    }

    .option {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 20px;
      width: 280px;
    }

    .option-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .vote-count {
      font-size: 18px;
      color: #555;
      margin-bottom: 15px;
    }

    .vote-button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
    }

    .vote-button:hover {
      background: #0056b3;
    }

    .share-options {
      display: none;
      margin-top: 10px;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .share-options button {
      background: #e0e0e0;
      border: none;
      border-radius: 6px;
      padding: 5px 10px;
      font-size: 14px;
      cursor: pointer;
    }

    .share-options button:hover {
      background: #ccc;
    }
  </style>
</head>
<body>

  <h1>Кто круче?</h1>

  <div class="battle-container">
    <div class="option" id="opt1">
      <div class="option-title">Кот</div>
      <div class="vote-count">Голосов: <span id="count1">0</span></div>
      <button class="vote-button" onclick="showShare(1)">Vote now</button>
      <div class="share-options" id="share1">
        <button onclick="shareAndVote(1, 'facebook')">Facebook</button>
        <button onclick="shareAndVote(1, 'twitter')">Twitter</button>
        <button onclick="shareAndVote(1, 'whatsapp')">WhatsApp</button>
        <button onclick="shareAndVote(1, 'reddit')">Reddit</button>
      </div>
    </div>

    <div class="option" id="opt2">
      <div class="option-title">Собака</div>
      <div class="vote-count">Голосов: <span id="count2">0</span></div>
      <button class="vote-button" onclick="showShare(2)">Vote now</button>
      <div class="share-options" id="share2">
        <button onclick="shareAndVote(2, 'facebook')">Facebook</button>
        <button onclick="shareAndVote(2, 'twitter')">Twitter</button>
        <button onclick="shareAndVote(2, 'whatsapp')">WhatsApp</button>
        <button onclick="shareAndVote(2, 'reddit')">Reddit</button>
      </div>
    </div>
  </div>

  <script>
    // Инициализация голосов
    if (!localStorage.getItem("votes")) {
      localStorage.setItem("votes", JSON.stringify({ option1: 0, option2: 0 }));
    }

    function loadVotes() {
      const votes = JSON.parse(localStorage.getItem("votes"));
      document.getElementById("count1").textContent = votes.option1;
      document.getElementById("count2").textContent = votes.option2;
    }

    function showShare(option) {
      document.getElementById("share1").style.display = "none";
      document.getElementById("share2").style.display = "none";
      document.getElementById("share" + option).style.display = "flex";
    }

    function shareAndVote(option, platform) {
      const votes = JSON.parse(localStorage.getItem("votes"));
      if (option === 1) votes.option1++;
      else votes.option2++;
      localStorage.setItem("votes", JSON.stringify(votes));
      loadVotes();

      const url = encodeURIComponent(window.location.href);
      const text = encodeURIComponent("Голосуй в батле: Кто круче — Кот или Собака?");
      let shareUrl = "";

      switch (platform) {
        case "facebook":
          shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
          break;
        case "twitter":
          shareUrl = `https://twitter.com/intent/tweet?text=${text}&url=${url}`;
          break;
        case "whatsapp":
          shareUrl = `https://wa.me/?text=${text}%20${url}`;
          break;
        case "reddit":
          shareUrl = `https://www.reddit.com/submit?url=${url}&title=${text}`;
          break;
      }

      window.open(shareUrl, "_blank");
    }

    loadVotes();
  </script>
<script>
  const SUPABASE_URL = 'https://oleqibxqfwnvaorqgflp.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9sZXFpYnhxZndudmFvcnFnZmxwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYzNjExMTQsImV4cCI6MjA2MTkzNzExNH0.AdpIio7ZnNpQRMeY_8Sb1bXqKpmYDeR7QYvAfnssdCA';

  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  
  async function loadBattle() {
    const { data, error } = await supabase
      .from('battles')
      .select('*')
      .order('created_at', { ascending: false })
      .limit(1)
      .single();

    if (error || !data) {
      console.error('Ошибка загрузки батла:', error);
      return;
    }

    window.currentBattle = data;

    const battleDiv = document.getElementById('battle');
    battleDiv.innerHTML = `
      <h2>${data.title}</h2>
      <div style="display: flex; gap: 40px; justify-content: center;">
        <div style="text-align:center;">
          <p><strong>${data.option1}</strong></p>
          <button onclick="vote(1)">Vote</button>
          <p id="votes1">${data.votes1} votes</p>
        </div>
        <div style="text-align:center;">
          <p><strong>${data.option2}</strong></p>
          <button onclick="vote(2)">Vote</button>
          <p id="votes2">${data.votes2} votes</p>
        </div>
      </div>
    `;
  }

  async function vote(option) {
    const field = option === 1 ? 'votes1' : 'votes2';
    const newCount = (window.currentBattle[field] || 0) + 1;

    const { error } = await supabase
      .from('battles')
      .update({ [field]: newCount })
      .eq('id', window.currentBattle.id);

    if (error) {
      console.error('Ошибка при голосовании:', error);
      return;
    }

    // Обновим данные на экране
    window.currentBattle[field] = newCount;
    document.getElementById(`votes${option}`).textContent = `${newCount} votes`;
  }

  loadBattle();
</script>
</body>
</html>
